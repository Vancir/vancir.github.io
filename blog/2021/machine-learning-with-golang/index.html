<!DOCTYPE html> <html lang="en"> <head> <meta name="google-site-verification" content="kFTGHTKWYnz7RkFa5Fi4_Tfdijlcl0sWeQbJo40mXOw"/> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>实践: 使用Golang进行机器学习 | Song Liu</title> <meta name="author" content="Song Liu"/> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@200&display=swap" rel="stylesheet"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.ico"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://vancir.github.io/blog/2021/machine-learning-with-golang/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://vancir.github.io/">Song Liu</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" target="_blank" href="/assets/pdf/resume.pdf">Resume</a> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-4"> <div class="post"> <header class="post-header"> <h1 class="post-title">实践: 使用Golang进行机器学习</h1> <p class="post-meta">January 31, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/golang"> <i class="fas fa-hashtag fa-sm"></i> golang</a>   <a href="/blog/tag/ml"> <i class="fas fa-hashtag fa-sm"></i> ml</a>   </p> </header> <article class="post-content"> <p>主流当下进行机器学习当然都是用的Python, 我的大部分工作也基本都是使用Python完成的. 但是Python的性能实在是太捉襟见肘, 所以我后面转向了Golang. 使用Golang进行机器学习对我而言是能更快地学习两者. 接下来我就来介绍在这过程中的学习和记录.</p> <h2 id="开发环境配置">开发环境配置</h2> <p>我的机器配置是双AMD的3700x+5700xt, 安装的黑苹果macOS Catalina 10.15.7这其实还挺麻烦的.</p> <ul> <li> <p>Tensorflow: 只是需要注意Python的版本. Tensorflow的支持版本是3.5-3.8我的版本是3.9, 所以我还需要安装3.8版本的Python</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c"># brew install python@3.8</span>
<span class="c"># echo 'export PATH="/usr/local/opt/python@3.8/bin:$PATH"' &gt;&gt; ~/.zshrc</span>
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip <span class="nb">install </span>tensorflow
</code></pre></div> </div> </li> <li> <p>Mercurial: <code class="language-plaintext highlighter-rouge">brew install mercurial</code></p> </li> <li> <p>Minikube: <code class="language-plaintext highlighter-rouge">brew install minikube</code></p> </li> <li> <p>Pachyderm: <code class="language-plaintext highlighter-rouge">brew tap pachyderm/tap &amp;&amp; brew install pachyderm/tap/pachctl@1.9</code></p> </li> </ul> <h2 id="golang进行数据处理">Golang进行数据处理</h2> <p>如果是手动解析数据的话, 需要手动定义数据格式, 并且对于异常数据的错误处理会很麻烦.</p> <ul> <li>csv文件使用<code class="language-plaintext highlighter-rouge">go-gota/gota/dataframe</code>进行处理.</li> </ul> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irisDF</span> <span class="o">:=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">ReadCSV</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">filter</span> <span class="o">:=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">F</span><span class="p">{</span>
	<span class="n">Colname</span><span class="o">:</span>    <span class="s">"species"</span><span class="p">,</span>
	<span class="n">Comparator</span><span class="o">:</span> <span class="s">"=="</span><span class="p">,</span>
	<span class="n">Comparando</span><span class="o">:</span> <span class="s">"Iris-versicolor"</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">versicolorDF</span> <span class="o">:=</span> <span class="n">irisDF</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="n">filter</span><span class="p">)</span><span class="o">.</span><span class="n">Select</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"sepal_width"</span><span class="p">,</span> <span class="s">"species"</span><span class="p">})</span><span class="o">.</span><span class="n">Subset</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">})</span>
</code></pre></div></div> <ul> <li>json文件使用<code class="language-plaintext highlighter-rouge">tidwall/gjson</code>和<code class="language-plaintext highlighter-rouge">tidwall/sjson</code>可以不需要定义schema就可以读取/设置</li> </ul> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">json</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s">"../data/station_status.json"</span><span class="p">)</span>
<span class="n">value</span> <span class="o">:=</span> <span class="n">gjson</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="s">"last_updated"</span><span class="p">)</span>

<span class="n">modified_json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">sjson</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="s">"last_updated"</span><span class="p">,</span> <span class="s">"123456"</span><span class="p">)</span>
<span class="n">modified_value</span> <span class="o">:=</span> <span class="n">gjson</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">modified_json</span><span class="p">,</span> <span class="s">"last_updated"</span><span class="p">)</span>
</code></pre></div></div> <ul> <li>数据缓存: 使用<code class="language-plaintext highlighter-rouge">patrickmn/go-cache</code>在内存中缓存一系列数值</li> </ul> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">:=</span> <span class="n">cache</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">5</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">,</span> <span class="m">30</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">,</span> <span class="s">"myvalue"</span><span class="p">,</span> <span class="n">cache</span><span class="o">.</span><span class="n">DefaultExpiration</span><span class="p">)</span>
<span class="n">v</span><span class="p">,</span> <span class="n">found</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">)</span>
</code></pre></div></div> <ul> <li> <p>数据本地缓存: <code class="language-plaintext highlighter-rouge">boltdb/bolt</code>被归档了, 所以我正在考虑其替代品<code class="language-plaintext highlighter-rouge">Badger</code></p> </li> <li> <p>数据版本控制: <code class="language-plaintext highlighter-rouge">minikube start &amp;&amp; pachctl deploy local</code> 在本地部署一个单机节点</p> </li> </ul> <h2 id="向量和矩阵操作">向量和矩阵操作</h2> <p>使用 <code class="language-plaintext highlighter-rouge">gonum/floats</code>进行向量操作:</p> <ul> <li>定义向量: <code class="language-plaintext highlighter-rouge">vector := []float64{11.0, 5.2, -1.3}</code> </li> <li>点积: <code class="language-plaintext highlighter-rouge">dotProduct := floats.Dot(vectorA, vectorB)</code> </li> <li>标准化: <code class="language-plaintext highlighter-rouge">floats.Scale(1.5, vectorA)</code> </li> <li>范数: <code class="language-plaintext highlighter-rouge">normA := floats.Norm(vectorA, 2)</code> </li> </ul> <p>使用<code class="language-plaintext highlighter-rouge">gonum/mat</code>进行操作</p> <ul> <li>定义向量: ` vectorA := mat.NewVecDense(3, []float64{11.0, 5.2, -1.3})`</li> <li>点积: <code class="language-plaintext highlighter-rouge">dotProduct := mat.Dot(vectorA, vectorB)</code> </li> <li>标准化: <code class="language-plaintext highlighter-rouge">vectorA.ScaleVec(1.5, vectorA)</code> </li> <li>范数: <code class="language-plaintext highlighter-rouge">normB := blas64.Nrm2(vectorB.RawVector())</code> </li> </ul> <p>给定切片创建矩阵:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">components</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="m">1.2</span><span class="p">,</span> <span class="o">-</span><span class="m">5.7</span><span class="p">,</span> <span class="o">-</span><span class="m">2.4</span><span class="p">,</span> <span class="m">7.3</span><span class="p">}</span>
<span class="n">a</span> <span class="o">:=</span> <span class="n">mat</span><span class="o">.</span><span class="n">NewDense</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">components</span><span class="p">)</span>
<span class="n">fa</span> <span class="o">:=</span> <span class="n">mat</span><span class="o">.</span><span class="n">Formatted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">FormatPython</span><span class="p">())</span>
</code></pre></div></div> <p>访问和设置矩阵数值</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">val</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">At</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">col</span> <span class="o">:=</span> <span class="n">mat</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span><span class="no">nil</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">row</span> <span class="o">:=</span> <span class="n">mat</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="no">nil</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="n">a</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">11.2</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="m">14.3</span><span class="p">,</span> <span class="o">-</span><span class="m">4.2</span><span class="p">})</span>
<span class="n">a</span><span class="o">.</span><span class="n">SetCol</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="m">1.7</span><span class="p">,</span> <span class="o">-</span><span class="m">0.3</span><span class="p">})</span>
</code></pre></div></div> <p>加减乘等: <code class="language-plaintext highlighter-rouge">d.Add(a, b)</code>, <code class="language-plaintext highlighter-rouge">d.Sub(a, b)</code>, <code class="language-plaintext highlighter-rouge">d.Mul(a, b)</code>, <code class="language-plaintext highlighter-rouge">d.Pow(a, 5)</code>, <code class="language-plaintext highlighter-rouge">d.Apply(sqrt, a)</code></p> <p>行列式: <code class="language-plaintext highlighter-rouge">deta := mat.Det(a)</code>, 转置: <code class="language-plaintext highlighter-rouge">a.T()</code>, 逆矩阵: <code class="language-plaintext highlighter-rouge">aInverse.Inverse(a)</code></p> <h2 id="测量数据分布情况">测量数据分布情况</h2> <p>使用<code class="language-plaintext highlighter-rouge">gonum/stat</code> 和<code class="language-plaintext highlighter-rouge">montanaflynn/stats</code>进行基本的数据测量: 均值: <code class="language-plaintext highlighter-rouge">stat.Mean</code>, 众数: <code class="language-plaintext highlighter-rouge">stat.Mode</code>, 中位数: <code class="language-plaintext highlighter-rouge">stats.Median</code></p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0" style="text-align: center;"> © Copyright 2025 Song Liu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-ER5P9GS1T8"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ER5P9GS1T8");</script> </body> </html>